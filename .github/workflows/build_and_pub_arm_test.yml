name: Build and publish docker test

on: push

env:                                                                                                                    
  REGISTRY: ghcr.io                                                                                                     
  IMAGE_NAME: ${{ github.repository }}                                                                                  
jobs:                                                                                                                   
  build-and-push-image:                                                                                                 
    strategy:                                                                                                           
      matrix:                                                                                                           
        os: [ubuntu-24.04,ubuntu-24.04-arm]                                                                             
                                                                                                                        
    runs-on: ${{ matrix.os }}                                                                                           
                                                                                                                        
    permissions:                                                                                                        
      contents: read                                                                                                    
      packages: write                                                                                                   
      attestations: write                                                                                               
      id-token: write                                                                                                   
                                                                                                                        
    steps:                                                                                                              
      - name: Checkout repository                                                                                       
        uses: actions/checkout@v4                                                                                       
                                                                                                                        
      - name: Log in to the Container registry                                                                          
        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1                                              
        with:                                                                                                           
          registry: ${{ env.REGISTRY }}                                                                                 
          username: ${{ github.actor }}                                                                                 
          password: ${{ secrets.GITHUB_TOKEN }}               
